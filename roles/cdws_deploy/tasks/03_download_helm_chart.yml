---
# Download Helm Chart
# -----------------------------------------------------------------------------
- name: "Cleanup old Helm chart file"
  ansible.builtin.file:
    path: "{{ my_workdir }}/ibm-cdws-{{ compatibility_matrix[cdws_version].helm_version }}.tgz"
    state: absent

- name: "Download Helm chart for C:D WebServices"
  ansible.builtin.get_url:
    url: "https://raw.githubusercontent.com/IBM/charts/master/repo/ibm-helm/ibm-cdws-{{ compatibility_matrix[cdws_version].helm_version }}.tgz"
    dest: "{{ my_workdir }}/ibm-cdws-{{ compatibility_matrix[cdws_version].helm_version }}.tgz"
    mode: "0640"
  register: download_result
  until: download_result is succeeded
  retries: 3
  delay: 5

- name: "Set fact for Helm chart file path"
  ansible.builtin.set_fact:
    cdws_helm_chart_file: "{{ my_workdir }}/ibm-cdws-{{ compatibility_matrix[cdws_version].helm_version }}.tgz"

- name: Debug Helm chart download
  ansible.builtin.debug:
    msg:
      - "Helm chart version ............ {{ compatibility_matrix[cdws_version].helm_version }}"
      - "Helm chart file ............... {{ cdws_helm_chart_file }}"
      - "Download status ............... {{ 'Success' if download_result is succeeded else 'Failed' }}"


